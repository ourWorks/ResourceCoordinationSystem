webpackJsonp([9],{Wak7:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("Y0bB"),n=a.n(l),o=a("dZWe"),i=a("mIjv"),r=a("tnU5"),s={name:"volunteer_task",data:function(){return{tableData:[{deadline:0,longitude:0,latitude:0,peopleNum:"",dailyResource:"",medicalResource:"",state:""}],today:Object(i.a)(new Date,"{y}-{m}-{d}"),pageSize:8,currentPage:1,dialogFormVisible:!1,form:{name:"",newState:"",delivery:!1,type:[],resource:"",desc:""},formLabelWidth:"120px"}},mounted:function(){var e=this;return new n.a(function(t,a){Object(r.h)().then(function(a){for(var l=0;l<a.data.length;l++)a.data[l].deadline=Object(i.a)(a.data[l].deadline);e.tableData=a.data,t()}).catch(function(e){a(e)})})},methods:{resetDateFilter:function(){this.$refs.filterTable.clearFilter("date")},clearFilter:function(){this.$refs.filterTable.clearFilter()},formatter:function(e,t){return e.address},filterTag:function(e,t){return t.state===e},filterHandler:function(e,t,a){return t[a.property].slice(0,10)===e},showPosition:function(e,t){this.$router.push({name:"volunteer_findPosition",params:{task_longitude:t.longitude,task_latitude:t.latitude}})},delTask:function(e,t){console.log(e,t),console.log("点击了删除"),Object(o.a)(t.cid),this.$message.success("删除成功！")},changeState:function(e,t){console.log(e,t),console.log("点击了标记"),localStorage.setItem("mark_row_cid",t.cid),this.dialogFormVisible=!0},handleChangeState:function(){var e=this;console.log(localStorage.getItem("mark_row_cid")),""==this.form.newState?this.$message.info("必须选择状态才能修改！"):(alert(this.form.newState),Object(r.c)({cid:localStorage.getItem("mark_row_cid"),state:this.form.newState}).then(function(t){for(var a=0;a<e.tableData.length;a++)e.tableData[a].cid==localStorage.getItem("mark_row_cid")&&(e.tableData[a].state=e.form.newState,"待救援"===e.tableData[a].state&&Object(r.h)().then(function(t){for(var a=0;a<t.data.length;a++)t.data[a].deadline=Object(i.a)(t.data[a].deadline);e.tableData=t.data,resolve()}).catch(function(e){reject(e)}))}),this.$message.success("修改成功！"),this.dialogFormVisible=!1)},handleSizeChange:function(e){this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"task_div"},[a("div",{staticStyle:{"margin-top":"20px","text-align":"left"}}),e._v(" "),a("el-table",{ref:"filterTable",staticStyle:{width:"100%"},attrs:{data:e.tableData.slice((e.currentPage-1)*e.pageSize,e.currentPage*e.pageSize)}},[a("el-table-column",{attrs:{prop:"state",label:"状态",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"已完成"===t.row.state?"success":"danger","disable-transitions":""}},[e._v(e._s(t.row.state)+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"常用操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return e.showPosition(t.$index,t.row)}}},[e._v("位置\n        ")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.changeState(t.$index,t.row)}}},[e._v("标记状态\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"deadline",label:"约定时间",sortable:"",width:"160","column-key":"date",filters:[{text:"今天",value:e.today}],"filter-method":e.filterHandler}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"联系电话",width:"120"}}),e._v(" "),a("el-table-column",{staticStyle:{"text-align":"center"},attrs:{prop:"peopleNum",label:"求助人数",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dailyResource",label:"日用资源",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"medicalResource",label:"医疗资源",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"comment",label:"备注",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{label:"谨慎操作",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.delTask(t.$index,t.row)}}},[e._v("删除\n        ")])]}}])})],1),e._v(" "),a("div",{staticClass:"page_div"},[a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[8,16,23,32,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"标记状态",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{attrs:{model:e.form}},[a("el-form-item",{attrs:{label:"状态","label-width":e.formLabelWidth}},[a("el-select",{attrs:{placeholder:"请选择状态"},model:{value:e.form.newState,callback:function(t){e.$set(e.form,"newState",t)},expression:"form.newState"}},[a("el-option",{attrs:{label:"待救援",value:"待救援"}}),e._v(" "),a("el-option",{attrs:{label:"已完成",value:"已完成"}}),e._v(" "),a("el-option",{attrs:{label:"救援中",value:"救援中"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleChangeState}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var d=a("e/h9")(s,c,!1,function(e){a("lQM8")},"data-v-789c0661",null);t.default=d.exports},lQM8:function(e,t){}});
//# sourceMappingURL=9.edcfaa25fe50742b09cd.js.map