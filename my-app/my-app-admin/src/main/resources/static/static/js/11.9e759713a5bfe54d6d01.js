webpackJsonp([11],{"1Yc8":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("Pwhg"),n=a("tnU5"),o={data:function(){return{tableData:[],search:"",formInline:{time:"",resource:"",position:""},pageSize:8,currentPage:1,dialogFormVisible:!1,json_fields:{"志愿者":"volunteerName","志愿者手机号":"volunteerPhone","值班状态":"ondueState","求助市民":"citizenName","市民手机号":"citizenPhone","安排时间":"time","状态":"state"},addFormData:[],addTitle:"排班结果"}},mounted:function(){this.updateArrangeForm()},methods:{updateArrangeForm:function(){var e=this;Object(l.e)({orgId:localStorage.getItem("l_orgId")}).then(function(t){e.tableData=t.data})},handleEdit:function(e,t){console.log(e,t)},handleDelete:function(e,t){var a=this;console.log(t.cid),null==t.citizenName?this.$message.info("这个志愿者还没有排班！"):Object(n.c)({cid:t.cid,state:"待救援"}).then(function(e){null!=e.data&&(a.$message.success("成功撤销排班！"),a.updateArrangeForm())})},onSubmit:function(){var e=this;console.log("submit!");var t="",a="";""!=this.formInline.time&&(t+=this.formInline.time,a+="时间"),""!=this.formInline.resource&&(t=t+","+this.formInline.resource,a+="+资源"),""!=this.formInline.position&&(t=t+","+this.formInline.position,a+="+5公里内"),","==t.substr(0,1)&&(t=t.substr(1,t.length),a=a.substr(1,t.length)),console.log(t),Object(l.a)({strategy:t,orgId:localStorage.getItem("l_orgId")}).then(function(t){null!=t.data?(e.addTitle="排班策略【"+a+"】下，新增排班信息："+t.data.length+"条",e.addFormData=t.data,e.dialogFormVisible=!0,e.updateArrangeForm()):e.$message.info("当前条件下已无法进行更多排班~")})},handleSelectionChange:function(e){this.multipleSelection=e},handleSizeChange:function(e){this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e},dateFormat:function(e,t,a,l){return null!=a?a.split("-")[1]+"-"+a.split("-")[1]+" "+a.split("T")[1]:null},handleChangeState:function(){this.dialogFormVisible=!1}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%",height:"100%"}},[a("div",{staticStyle:{width:"100%",height:"auto","text-align":"center","font-family":"'Microsoft YaHei UI',serif","font-size":"larger","margin-bottom":"1%"}},[e._v("\n      设置策略\n    ")]),e._v(" "),a("div",{staticStyle:{"font-family":"'Times New Roman',serif","font-size":"x-small","text-align":"center","font-weight":"lighter",color:"red","margin-bottom":"1%"}},[e._v('\n      *每次排班最多给志愿者安排一个"待救援"任务，安排之后任务状态变更为“已分配”\n    ')]),e._v(" "),a("div",{staticStyle:{width:"100%",height:"10%"}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:22,offset:2}},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline}},[a("el-form-item",{attrs:{label:"考虑时间"}},[a("el-select",{staticStyle:{width:"105px"},attrs:{placeholder:"选择条件"},model:{value:e.formInline.time,callback:function(t){e.$set(e.formInline,"time",t)},expression:"formInline.time"}},[a("el-option",{attrs:{label:"是",value:"time"}}),e._v(" "),a("el-option",{attrs:{label:"否",value:""}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"考虑资源"}},[a("el-select",{staticStyle:{width:"105px"},attrs:{placeholder:"选择条件"},model:{value:e.formInline.resource,callback:function(t){e.$set(e.formInline,"resource",t)},expression:"formInline.resource"}},[a("el-option",{attrs:{label:"是",value:"resource"}}),e._v(" "),a("el-option",{attrs:{label:"否",value:""}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"考虑位置"}},[a("el-select",{staticStyle:{width:"105px"},attrs:{placeholder:"选择条件"},model:{value:e.formInline.position,callback:function(t){e.$set(e.formInline,"position",t)},expression:"formInline.position"}},[a("el-option",{attrs:{label:"5公里内",value:"position"}}),e._v(" "),a("el-option",{attrs:{label:"否",value:""}})],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("一键排班")])],1),e._v(" "),a("el-form-item",[a("download-excel",{attrs:{data:e.tableData,fields:e.json_fields,head:"排班表",type:"xls",name:"排班信息"}},[a("el-button",{attrs:{type:"success"}},[e._v(" 导出排班信息")])],1)],1)],1)],1)],1)],1),e._v(" "),a("div",{staticStyle:{width:"100%"}},[a("el-row",[a("el-col",{attrs:{span:22,offset:1}},[a("el-table",{staticStyle:{width:"100%"},attrs:{fit:"",size:"small",border:"",data:e.tableData.filter(function(t){return!e.search||t.volunteerName.toLowerCase().includes(e.search.toLowerCase())}).slice((e.currentPage-1)*e.pageSize,e.currentPage*e.pageSize)}},[a("el-table-column",{attrs:{label:"志愿者",prop:"volunteerName"}}),e._v(" "),a("el-table-column",{attrs:{label:"志愿者手机号",prop:"volunteerPhone"}}),e._v(" "),a("el-table-column",{attrs:{label:"值班状态",prop:"ondueState"}}),e._v(" "),a("el-table-column",{attrs:{label:"求助市民",prop:"citizenName"}}),e._v(" "),a("el-table-column",{attrs:{label:"市民手机号",prop:"citizenPhone"}}),e._v(" "),a("el-table-column",{attrs:{label:"安排救援时间",formatter:e.dateFormat,prop:"time"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态",prop:"state",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"已分配"===t.row.state?"success":"救援中"===t.row.state?"info":"white","disable-transitions":""}},[e._v(e._s(t.row.state)+"\n                ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[a("el-input",{attrs:{size:"small",placeholder:"搜志愿者"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}},{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("撤销排班\n                ")])]}}])})],1),e._v(" "),a("div",{staticClass:"page_div"},[a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[8,16,24,32,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.addTitle,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{fit:"",size:"small",border:"",data:e.addFormData.slice((e.currentPage-1)*e.pageSize,e.currentPage*e.pageSize)}},[a("el-table-column",{attrs:{label:"志愿者",prop:"volunteerName"}}),e._v(" "),a("el-table-column",{attrs:{label:"志愿者手机号",prop:"volunteerPhone"}}),e._v(" "),a("el-table-column",{attrs:{label:"值班状态",prop:"ondueState"}}),e._v(" "),a("el-table-column",{attrs:{label:"求助市民",prop:"citizenName"}}),e._v(" "),a("el-table-column",{attrs:{label:"市民手机号",prop:"citizenPhone"}}),e._v(" "),a("el-table-column",{attrs:{label:"安排救援时间",formatter:e.dateFormat,prop:"time"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态",prop:"state",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:""!==t.row.state?"success":"","disable-transitions":""}},[e._v(e._s(t.row.state)+"\n            ")])]}}])})],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleChangeState}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var r=a("e/h9")(o,i,!1,function(e){a("CJXY")},"data-v-701f8811",null);t.default=r.exports},CJXY:function(e,t){}});
//# sourceMappingURL=11.9e759713a5bfe54d6d01.js.map